name: Reset Workflows

on:
  workflow_run:
    workflows: 
      - "Persistent Login (Contas 1-10)"
      - "Persistent Login (Contas 11-20)"
      - "Persistent Login (Contas 21-30)"
      - "Persistent Login (Contas 31-40)"
      - "Persistent Login (Contas 41-50)"
    types:
      - completed

jobs:
  restart:
    if: ${{ vars.HABILITAR_REINICIO == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Dispara novamente o workflow que acabou
        run: |
          echo "Reiniciando workflow: ${{ github.event.workflow_run.name }}"

          case "${{ github.event.workflow_run.name }}" in
            "Persistent Login (Contas 1-10)")
              WF_FILE="persistent-login-1-10.yml"
              ;;
            "Persistent Login (Contas 11-20)")
              WF_FILE="persistent-login-11-20.yml"
              ;;
            "Persistent Login (Contas 21-30)")
              WF_FILE="persistent-login-21-30.yml"
              ;;
            "Persistent Login (Contas 31-40)")
              WF_FILE="persistent-login-31-40.yml"
              ;;
            "Persistent Login (Contas 41-50)")
              WF_FILE="persistent-login-41-50.yml"
              ;;
            *)
              echo "Workflow não mapeado para reinício."
              exit 0
              ;;
          esac

          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/$WF_FILE/dispatches \
            -d '{"ref":"${{ github.ref_name }}"}'
