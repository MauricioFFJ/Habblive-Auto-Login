name: Reset Workflows

on:
  workflow_run:
    workflows: 
      - "Persistent Login (Contas 1-5)"
      - "Persistent Login (Contas 6-10)"
      - "Persistent Login (Contas 11-15)"
      - "Persistent Login (Contas 16-20)"
      - "Persistent Login (Contas 21-25)"
      - "Persistent Login (Contas 26-30)"
      - "Persistent Login (Contas 31-35)"
      - "Persistent Login (Contas 36-40)"
      - "Persistent Login (Contas 41-45)"
      - "Persistent Login (Contas 46-50)"
    types:
      - completed

jobs:
  restart:
    if: ${{ vars.HABILITAR_REINICIO == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Dispara novamente o workflow que acabou
        run: |
          echo "Reiniciando workflow: ${{ github.event.workflow_run.name }}"

          case "${{ github.event.workflow_run.name }}" in
            "Persistent Login (Contas 1-5)")
              WF_FILE="persistent-login-1-5.yml"
              ;;
            "Persistent Login (Contas 6-10)")
              WF_FILE="persistent-login-6-10.yml"
              ;;
            "Persistent Login (Contas 11-15)")
              WF_FILE="persistent-login-11-15.yml"
              ;;
            "Persistent Login (Contas 16-20)")
              WF_FILE="persistent-login-16-20.yml"
              ;;
            "Persistent Login (Contas 21-25)")
              WF_FILE="persistent-login-21-25.yml"
              ;;
            "Persistent Login (Contas 26-30)")
              WF_FILE="persistent-login-26-30.yml"
              ;;
            "Persistent Login (Contas 31-35)")
              WF_FILE="persistent-login-31-35.yml"
              ;;
            "Persistent Login (Contas 36-40)")
              WF_FILE="persistent-login-36-40.yml"
              ;;
            "Persistent Login (Contas 41-45)")
              WF_FILE="persistent-login-41-45.yml"
              ;;
            "Persistent Login (Contas 46-50)")
              WF_FILE="persistent-login-46-50.yml"
              ;;
            *)
              echo "Workflow não mapeado para reinício."
              exit 0
              ;;
          esac

          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/repos/${{ github.repository }}/actions/workflows/$WF_FILE/dispatches \
            -d '{"ref":"${{ github.ref_name }}"}'
